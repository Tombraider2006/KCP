<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: https: http:; script-src 'self' 'unsafe-inline' 'unsafe-eval';">
    <title>Tom Tomich's 3D Printer Control Panel</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-main">
                <h1>üñ®Ô∏è Tom Tomich's 3D Printer Control Panel</h1>
                <div class="app-version" id="appVersion">v‚Äî</div>
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="openAddPrinterModal()">‚ûï Add Printer</button>
                <button class="btn btn-secondary" onclick="testAllConnections()">üîç Test All Connections</button>
                <button class="btn btn-telegram" onclick="openTelegramSettingsModal()">ü§ñ Telegram</button>
                <button class="btn btn-secondary" onclick="openAnalyticsModal()">üìà <span id="analyticsBtnText">Analytics</span></button>
                <div class="interval-selector">
                    <label>Polling interval: </label>
                    <select id="pollingInterval" onchange="updatePollingInterval(this.value)">
                        <option value="10000">10 sec</option>
                        <option value="15000">15 sec</option>
                        <option value="20000">20 sec</option>
                        <option value="30000" selected>30 sec</option>
                        <option value="45000">45 sec</option>
                        <option value="60000">60 sec</option>
                        <option value="75000">75 sec</option>
                        <option value="90000">90 sec</option>
                    </select>
                </div>
            </div>
            <div class="printers-counter">
                <span class="counter printing">üñ®Ô∏è <span id="count-printing">0</span></span>
                <span class="counter offline">üîå <span id="count-offline">0</span></span>
                <span class="counter ready">‚úÖ <span id="count-ready">0</span></span>
                <span class="counter complete">üèÅ <span id="count-complete">0</span></span>
                <span class="counter paused">‚è∏Ô∏è <span id="count-paused">0</span></span>
                <span class="counter error">üö´ <span id="count-error">0</span></span>
            </div>
        </header>

        <main>
            <section class="card">
                <h2>üìä Printer Status</h2>
                <div id="printersContainer" class="printers-container"></div>
            </section>

            <section class="card">
                <h2>üìã Event Log</h2>
                <div class="console">
                    <div id="messageConsole" class="console-content"></div>
                    <div class="console-controls">
                        <button class="btn btn-small" onclick="clearConsole()">üóëÔ∏è Clear</button>
                        <button class="btn btn-small" onclick="exportLogs()">üì• Export</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Printer Modal -->
    <div id="addPrinterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add Printer</h3>
                <span class="close" onclick="closeAddPrinterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="printerName">Printer name:</label>
                    <input type="text" id="printerName" placeholder="My Printer">
                </div>
                <div class="form-group">
                    <label for="printerIP">IP address:</label>
                    <input type="text" id="printerIP" placeholder="192.168.1.100">
                </div>
                <div class="form-group">
                    <label for="printerPort">Moonraker port:</label>
                    <input type="number" id="printerPort" value="7125" placeholder="7125">
                </div>
                <div class="form-group">
                    <label for="webInterfacePort">Web interface port (optional):</label>
                    <input type="number" id="webInterfacePort" placeholder="80">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="addPrinter()">Add</button>
                    <button class="btn" onclick="closeAddPrinterModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Printer Modal -->
    <div id="editPrinterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Printer</h3>
                <span class="close" onclick="closeEditPrinterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editPrinterId">
                <div class="form-group">
                    <label for="editPrinterName">Printer name:</label>
                    <input type="text" id="editPrinterName">
                </div>
                <div class="form-group">
                    <label for="editPrinterIP">IP address:</label>
                    <input type="text" id="editPrinterIP" placeholder="192.168.1.100">
                </div>
                <div class="form-group">
                    <label for="editPrinterPort">Moonraker port:</label>
                    <input type="number" id="editPrinterPort" placeholder="7125">
                </div>
                <div class="form-group">
                    <label for="editWebInterfacePort">Web interface port (optional):</label>
                    <input type="number" id="editWebInterfacePort" placeholder="80">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="savePrinterChanges()">Save</button>
                    <button class="btn" onclick="closeEditPrinterModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Telegram Settings Modal -->
    <div id="telegramSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ü§ñ Telegram Settings</h3>
                <span class="close" onclick="closeTelegramSettingsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="telegramBotToken">Bot Token:</label>
                    <input type="text" id="telegramBotToken" placeholder="1234567890:ABCdefGHIjklMNopQRstUVwxyz">
                    <small>Get this from @BotFather in Telegram</small>
                </div>
                <div class="form-group">
                    <label for="telegramChatId">Chat ID:</label>
                    <input type="text" id="telegramChatId" placeholder="123456789">
                    <small>Send /start to your bot and check logs</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="telegramEnabled"> Enable Telegram notifications
                    </label>
                </div>
                <div class="notification-settings">
                    <h4>Notify on:</h4>
                    <label><input type="checkbox" id="notifyPrintComplete" checked> Print complete</label>
                    <label><input type="checkbox" id="notifyPrintError" checked> Print error</label>
                    <label><input type="checkbox" id="notifyPrintPaused" checked> Print paused</label>
                    <label><input type="checkbox" id="notifyPrinterOffline"> Printer offline</label>
                    <label><input type="checkbox" id="notifyPrinterOnline"> Printer online</label>
                    <label><input type="checkbox" id="notifyInefficiency" checked> Inefficiency event</label>
                    <label><input type="checkbox" id="notifyInefficiencyReason" checked> Inefficiency reason saved</label>
                    <label><input type="checkbox" id="notifyProgramStart" checked> Program start</label>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-help" onclick="openTelegramHelp()" style="margin-right: auto;">‚ùì Help</button>
                    <button class="btn btn-primary" onclick="saveTelegramSettings()">Save</button>
                    <button class="btn btn-secondary" onclick="testTelegramConnection()">Test Connection</button>
                    <button class="btn" onclick="closeTelegramSettingsModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content" style="max-width: 1100px;">
            <div class="modal-header">
                <h3>üìà Analytics</h3>
                <span class="close" onclick="closeAnalyticsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group" style="display:flex; gap:20px; align-items:center; flex-wrap:wrap;">
                    <div>
                        <label id="analyticsPeriodLabel">–ü–µ—Ä–∏–æ–¥:</label>
                        <select id="analyticsPeriod">
                            <option value="1d">–ó–∞ –¥–µ–Ω—å</option>
                            <option value="7d">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                            <option value="30d">–ó–∞ –º–µ—Å—è—Ü</option>
                            <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π</option>
                        </select>
                    </div>
                    <div>
                        <label id="analyticsPrinterLabel">–ü—Ä–∏–Ω—Ç–µ—Ä:</label>
                        <select id="analyticsPrinter"></select>
                    </div>
                    <div id="analyticsCustomRange" style="display:none; gap:10px; align-items:end;">
                        <div>
                            <label id="analyticsFromLabel">–°</label>
                            <input type="date" id="analyticsFrom" />
                        </div>
                        <div>
                            <label id="analyticsToLabel">–ü–æ</label>
                            <input type="date" id="analyticsTo" />
                        </div>
                    </div>
                </div>

                <div class="printers-counter" style="margin-top:10px;">
                    <span class="counter printing"><span id="stat-print-time">0s</span><span style="margin-left:6px;" id="kpiPrintLabel">–û–±—â–µ–µ –≤—Ä–µ–º—è –ø–µ—á–∞—Ç–∏</span></span>
                    <span class="counter ready"><span id="stat-idle-time">0s</span><span style="margin-left:6px;" id="kpiIdleLabel">–û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è</span></span>
                    <span class="counter complete"><span id="stat-efficiency">0.0%</span><span style="margin-left:6px;" id="kpiEffLabel">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span></span>
                    <span class="counter error"><span id="stat-energy-cost">0</span><span style="margin-left:6px;" id="kpiCostLabel">–°—Ç–æ–∏–º–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏</span></span>
                </div>

                <div class="tabs" style="display:flex; gap:20px; margin-top:15px;">
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('eff')" id="tabEffBtn">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('ineff')" id="tabIneffBtn">–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('energy')" id="tabEnergyBtn">–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('details')" id="tabDetailsBtn">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('settings')" id="tabSettingsBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('help')" id="tabHelpBtn">‚ùì –ü–æ–º–æ—â—å</button>
                </div>

                <div id="analyticsTabContent" style="margin-top:10px;">
                    <!-- content filled by renderer.js -->
                </div>
            </div>
        </div>
    </div>

    <!-- Audio element for completion sound -->
    <audio id="completionSound" preload="auto">
        <source src="windows-xp-print-complete.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script src="translations.js"></script>
    <script src="renderer.js"></script>
</body>
</html>