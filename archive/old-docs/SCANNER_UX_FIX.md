# Исправление UX при добавлении нескольких принтеров из сканера сети

## Проблема

При добавлении принтера из блока сканирования сети панель сканера закрывалась. Это было неудобно, если пользователь хотел добавить несколько принтеров подряд - приходилось каждый раз заново запускать сканирование.

## Причина

В функции `addPrinterFromScan()` (строка 5305-5306 в renderer.js) вызывалась функция `closeNetworkScanModal()`, которая закрывала панель сканирования перед открытием модального окна добавления принтера:

```javascript
function addPrinterFromScan(printerData) {
    // Закрываем модальное окно сканирования
    closeNetworkScanModal();  // ← ПРОБЛЕМА!
    
    // Открываем модальное окно добавления принтера
    openAddPrinterModal();
    // ...
}
```

## Решение

### 1. Панель сканирования остается открытой

Убрана строка `closeNetworkScanModal()` из функции `addPrinterFromScan()`. Теперь панель сканирования остается открытой, а модальное окно добавления принтера открывается поверх неё.

**До:**
```javascript
function addPrinterFromScan(printerData) {
    closeNetworkScanModal();  // Закрывали панель
    openAddPrinterModal();
    // ...
}
```

**После:**
```javascript
function addPrinterFromScan(printerData) {
    // Открываем модальное окно добавления принтера (панель сканирования остается открытой)
    openAddPrinterModal();
    // ...
}
```

### 2. Автоматическое обновление списка результатов

Добавлено автоматическое обновление списка результатов сканирования после добавления принтера. Теперь добавленные принтеры сразу помечаются как "уже добавлены" в списке результатов.

В функции `addPrinter()` после добавления принтера проверяется, открыта ли панель сканирования, и если да - обновляется отображение результатов:

```javascript
// Обновляем список результатов сканирования, если панель сканирования открыта
const networkScanModal = document.getElementById('networkScanModal');
if (networkScanModal && networkScanModal.style.display === 'block' && foundPrintersInScan.length > 0) {
    displayScanResults(foundPrintersInScan);
}
```

## UX Поток (до и после)

### До исправления ❌

1. Пользователь открывает сканер сети
2. Запускает сканирование
3. Находится несколько принтеров
4. Нажимает "Добавить" на первом принтере
5. **Панель сканирования закрывается** ❌
6. Открывается окно добавления принтера
7. Пользователь заполняет данные и сохраняет
8. Окно добавления закрывается
9. **Чтобы добавить второй принтер, нужно заново открыть сканер и повторить сканирование** ❌

### После исправления ✅

1. Пользователь открывает сканер сети
2. Запускает сканирование
3. Находится несколько принтеров
4. Нажимает "Добавить" на первом принтере
5. **Панель сканирования остается открытой** ✅
6. Открывается окно добавления принтера (поверх панели сканирования)
7. Пользователь заполняет данные и сохраняет
8. Окно добавления закрывается
9. **Панель сканирования все еще открыта с результатами** ✅
10. **Добавленный принтер помечен как "уже добавлен"** ✅
11. **Можно сразу добавить следующий принтер** ✅

## Технические детали

### Z-index модальных окон

Все модальные окна имеют одинаковый `z-index: 1000` (styles.css, строка 611). Это означает, что последнее открытое модальное окно будет отображаться поверх предыдущих. 

В нашем случае:
1. Сначала открыта панель сканирования (z-index: 1000)
2. Затем открывается окно добавления принтера (z-index: 1000) - оно будет поверх
3. После закрытия окна добавления панель сканирования остается видимой

### Глобальная переменная результатов

Результаты сканирования хранятся в глобальной переменной `foundPrintersInScan` (renderer.js, строка 5158), что позволяет обновлять отображение результатов после добавления принтера.

### Проверка существующих принтеров

Функция `displayScanResults()` проверяет, не добавлен ли уже принтер:

```javascript
const alreadyAdded = printers.some(p => p.ip === printer.ip);
```

И отображает соответствующую кнопку:
- Если принтер не добавлен: кнопка "➕ Добавить"
- Если принтер уже добавлен: неактивная кнопка "✓ Уже добавлен"

## Исправленные файлы

1. **src/renderer.js**:
   - Функция `addPrinterFromScan()` (строка 5304) - убрано закрытие панели сканирования
   - Функция `addPrinter()` (строка 710-714) - добавлено обновление списка результатов

## Дата исправления

10 октября 2025





