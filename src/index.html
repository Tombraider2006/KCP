<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: https: http:; script-src 'self' 'unsafe-inline' 'unsafe-eval';">
    <title>Tom Tomich's 3D Printer Control Panel</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-main">
                <div class="header-title">
                    <h1>üñ®Ô∏è Tom Tomich's 3D Printer Control Panel</h1>
                    <div class="app-version" id="appVersion">v‚Äî</div>
                </div>
                <div class="printers-counter">
                    <span class="counter printing">üßä <span id="count-printing">0</span></span>
                    <span class="counter offline">üîå <span id="count-offline">0</span></span>
                    <span class="counter ready">‚úÖ <span id="count-ready">0</span></span>
                    <span class="counter complete">üèÅ <span id="count-complete">0</span></span>
                    <span class="counter paused">‚è∏Ô∏è <span id="count-paused">0</span></span>
                    <span class="counter error">üö´ <span id="count-error">0</span></span>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="startNetworkScan()">üîß <span id="managePrintersBtnText">Manage Printers</span></button>
                <button class="btn btn-secondary" onclick="testAllConnections()">üîó Test All Connections</button>
                <button class="btn btn-telegram" onclick="openTelegramSettingsModal()">ü§ñ Telegram</button>
                <button class="btn btn-secondary" onclick="openAnalyticsModal()">üìà <span id="analyticsBtnText">Analytics</span></button>
                <button class="btn btn-web-server" id="webServerBtn" onclick="toggleWebServerModal()">
                    üåê <span id="webServerBtnText" data-i18n="web_server_btn_text">Web Server</span>
                </button>
                <div class="interval-selector">
                    <label>Polling interval: </label>
                    <select id="pollingInterval" onchange="updatePollingInterval(this.value)">
                        <option value="10000">10 sec</option>
                        <option value="15000">15 sec</option>
                        <option value="20000">20 sec</option>
                        <option value="30000" selected>30 sec</option>
                        <option value="45000">45 sec</option>
                        <option value="60000">60 sec</option>
                        <option value="75000">75 sec</option>
                        <option value="90000">90 sec</option>
                    </select>
                </div>
            </div>
        </header>

        <main>
            <section class="card">
                <h2>üìä Printer Status</h2>
                <div id="printersContainer" class="printers-container"></div>
            </section>

            <section class="card">
                <h2>üìã Event Log</h2>
                <div class="console">
                    <div id="messageConsole" class="console-content"></div>
                    <div class="console-controls">
                        <button class="btn btn-small" onclick="clearConsole()">üóëÔ∏è Clear</button>
                        <button class="btn btn-small" onclick="exportLogs()">üì• Export</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Printer Modal -->
    <div id="addPrinterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="add_printer">‚ûï Add Printer</h3>
                <span class="close" onclick="closeAddPrinterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="printerType" data-i18n="printer_type">Printer type:</label>
                    <select id="printerType" onchange="togglePrinterTypeFields('add')">
                        <option value="klipper" data-i18n="klipper_moonraker">Klipper (Moonraker)</option>
                        <option value="bambu" data-i18n="bambu_lab">Bambu Lab</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="printerName" data-i18n="printer_name">Printer name:</label>
                    <input type="text" id="printerName" placeholder="My Printer">
                </div>
                <div class="form-group">
                    <label for="printerIP" data-i18n="ip_address">IP address:</label>
                    <input type="text" id="printerIP" placeholder="192.168.1.100">
                </div>
                
                <!-- Klipper specific fields -->
                <div id="klipperFields" class="printer-type-fields">
                    <div class="form-group">
                        <label for="webInterfacePort" data-i18n="web_interface_port_optional">Web interface port (optional):</label>
                        <input type="number" id="webInterfacePort" placeholder="80">
                    </div>
                </div>
                
                <!-- Bambu Lab specific fields -->
                <div id="bambuFields" class="printer-type-fields" style="display: none;">
                    <div class="form-group">
                        <label for="accessCode" data-i18n="access_code">Access Code:</label>
                        <div style="display: flex; gap: 5px; align-items: center;">
                            <input type="password" id="accessCode" placeholder="12345678" style="flex: 1;">
                            <button type="button" class="toggle-visibility" data-target="accessCode" title="Show/Hide">
                                üëÅÔ∏è
                            </button>
                        </div>
                        <small data-i18n="access_code_hint">Get from printer settings ‚Üí Network ‚Üí Access Code</small>
                    </div>
                    <div class="form-group">
                        <label for="serialNumber" data-i18n="serial_number">Serial Number:</label>
                        <div style="display: flex; gap: 5px; align-items: center;">
                            <input type="password" id="serialNumber" placeholder="01P00A123456789" style="flex: 1;">
                            <button type="button" class="toggle-visibility" data-target="serialNumber" title="Show/Hide">
                                üëÅÔ∏è
                            </button>
                        </div>
                        <small data-i18n="serial_number_hint">Find on printer label or in settings</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="bambuDevMode" checked>
                            <span data-i18n="dev_mode_enabled">Developer Mode enabled on printer</span>
                        </label>
                        <small style="display: block; margin-top: 5px;" data-i18n="dev_mode_warning">‚ö†Ô∏è Developer mode must be enabled in printer settings</small>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="addPrinter()" data-i18n="add">Add</button>
                    <button class="btn" onclick="closeAddPrinterModal()" data-i18n="cancel">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Printer Modal -->
    <div id="editPrinterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Printer</h3>
                <span class="close" onclick="closeEditPrinterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editPrinterId">
                <div class="form-group">
                    <label for="editPrinterType">Printer type:</label>
                    <select id="editPrinterType" onchange="togglePrinterTypeFields('edit')">
                        <option value="klipper">Klipper (Moonraker)</option>
                        <option value="bambu">Bambu Lab</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editPrinterName">Printer name:</label>
                    <input type="text" id="editPrinterName">
                </div>
                <div class="form-group">
                    <label for="editPrinterIP">IP address:</label>
                    <input type="text" id="editPrinterIP" placeholder="192.168.1.100">
                </div>
                
                <!-- Klipper specific fields -->
                <div id="editKlipperFields" class="printer-type-fields">
                    <div class="form-group">
                        <label for="editPrinterPort">Moonraker port:</label>
                        <input type="number" id="editPrinterPort" placeholder="7125">
                    </div>
                    <div class="form-group">
                        <label for="editWebInterfacePort">Web interface port (optional):</label>
                        <input type="number" id="editWebInterfacePort" placeholder="80">
                    </div>
                </div>
                
                <!-- Bambu Lab specific fields -->
                <div id="editBambuFields" class="printer-type-fields" style="display: none;">
                    <div class="form-group">
                        <label for="editAccessCode" data-i18n="access_code">Access Code:</label>
                        <div style="display: flex; gap: 5px; align-items: center;">
                            <input type="password" id="editAccessCode" placeholder="12345678" style="flex: 1;">
                            <button type="button" class="toggle-visibility" data-target="editAccessCode" title="Show/Hide">
                                üëÅÔ∏è
                            </button>
                        </div>
                        <small data-i18n="access_code_hint">Get from printer settings ‚Üí Network ‚Üí Access Code</small>
                    </div>
                    <div class="form-group">
                        <label for="editSerialNumber" data-i18n="serial_number">Serial Number:</label>
                        <div style="display: flex; gap: 5px; align-items: center;">
                            <input type="password" id="editSerialNumber" placeholder="01P00A123456789" style="flex: 1;">
                            <button type="button" class="toggle-visibility" data-target="editSerialNumber" title="Show/Hide">
                                üëÅÔ∏è
                            </button>
                        </div>
                        <small data-i18n="serial_number_hint">Find on printer label or in settings</small>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="savePrinterChanges()">Save</button>
                    <button class="btn" onclick="closeEditPrinterModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Telegram Settings Modal -->
    <div id="telegramSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ü§ñ Telegram Settings</h3>
                <span class="close" onclick="closeTelegramSettingsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="telegramBotToken">Bot Token:</label>
                    <input type="text" id="telegramBotToken" placeholder="1234567890:ABCdefGHIjklMNopQRstUVwxyz">
                    <small>Get this from @BotFather in Telegram</small>
                </div>
                <div class="form-group">
                    <label for="telegramChatId">Chat ID:</label>
                    <input type="text" id="telegramChatId" placeholder="123456789">
                    <small>Send /start to your bot and check logs</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="telegramEnabled"> <span id="labelEnableTelegram">Enable Telegram notifications</span>
                    </label>
                </div>
                <div class="notification-settings">
                    <h4 id="telegramNotifyTitle">Notify on:</h4>
                    <label><input type="checkbox" id="notifyPrintComplete" checked> <span id="labelPrintComplete">Print complete</span></label>
                    <label><input type="checkbox" id="notifyPrintStart" checked> <span id="labelPrintStart">Print start</span></label>
                    <label><input type="checkbox" id="notifyPrintError" checked> <span id="labelPrintError">Print error</span></label>
                    <label><input type="checkbox" id="notifyPrintPaused" checked> <span id="labelPrintPaused">Print paused</span></label>
                    <label><input type="checkbox" id="notifyPrinterOffline"> <span id="labelPrinterOffline">Printer offline</span></label>
                    <label><input type="checkbox" id="notifyPrinterOnline"> <span id="labelPrinterOnline">Printer online</span></label>
                    <label><input type="checkbox" id="notifyInefficiency" checked> <span id="labelInefficiency">Inefficiency event</span></label>
                    <label><input type="checkbox" id="notifyInefficiencyReason" checked> <span id="labelInefficiencyReason">Inefficiency reason saved</span></label>
                    <label><input type="checkbox" id="notifyProgramStart" checked> <span id="labelProgramStart">Program start</span></label>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-help" onclick="showTelegramHelpModal()" style="margin-right: auto;" data-i18n="help">‚ùì Help</button>
                    <button class="btn btn-primary" onclick="saveTelegramSettings()">Save</button>
                    <button class="btn btn-secondary" onclick="testTelegramConnection()">Test Connection</button>
                    <button class="btn" onclick="closeTelegramSettingsModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content" style="max-width: 1100px;">
            <div class="modal-header">
                <h3>üìà Analytics</h3>
                <span class="close" onclick="closeAnalyticsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group" style="display:flex; gap:20px; align-items:center; flex-wrap:wrap;">
                    <div>
                        <label id="analyticsPeriodLabel">–ü–µ—Ä–∏–æ–¥:</label>
                        <select id="analyticsPeriod">
                            <option value="1d">–ó–∞ –¥–µ–Ω—å</option>
                            <option value="7d">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                            <option value="30d">–ó–∞ –º–µ—Å—è—Ü</option>
                            <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π</option>
                        </select>
                    </div>
                    <div>
                        <label id="analyticsPrinterLabel">–ü—Ä–∏–Ω—Ç–µ—Ä:</label>
                        <select id="analyticsPrinter"></select>
                    </div>
                    <div id="analyticsCustomRange" style="display:none; gap:10px; align-items:end;">
                        <div>
                            <label id="analyticsFromLabel">–°</label>
                            <input type="date" id="analyticsFrom" />
                        </div>
                        <div>
                            <label id="analyticsToLabel">–ü–æ</label>
                            <input type="date" id="analyticsTo" />
                        </div>
                    </div>
                </div>

                <div class="printers-counter" style="margin-top:10px;">
                    <span class="counter printing"><span id="stat-print-time">0s</span><span style="margin-left:6px;" id="kpiPrintLabel">–û–±—â–µ–µ –≤—Ä–µ–º—è –ø–µ—á–∞—Ç–∏</span></span>
                    <span class="counter ready"><span id="stat-idle-time">0s</span><span style="margin-left:6px;" id="kpiIdleLabel">–û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è</span></span>
                    <span class="counter complete"><span id="stat-efficiency">0.0%</span><span style="margin-left:6px;" id="kpiEffLabel">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span></span>
                    <span class="counter error"><span id="stat-energy-cost">0</span><span style="margin-left:6px;" id="kpiCostLabel">–°—Ç–æ–∏–º–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏</span></span>
                </div>

                <div class="tabs" style="display:flex; gap:20px; margin-top:15px;">
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('eff')" id="tabEffBtn">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('ineff')" id="tabIneffBtn">–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('energy')" id="tabEnergyBtn">–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('details')" id="tabDetailsBtn">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('settings')" id="tabSettingsBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button class="btn btn-secondary btn-small" onclick="setAnalyticsTab('help')" id="tabHelpBtn">‚ùì –ü–æ–º–æ—â—å</button>
                </div>

                <div id="analyticsTabContent" style="margin-top:10px;">
                    <!-- content filled by renderer.js -->
                </div>
            </div>
        </div>
    </div>

    <!-- Inefficiency Comment Modal -->
    <div id="inefficiencyCommentModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="ineffCommentModalTitle">üìù Add Comment</h3>
                <span class="close" onclick="closeInefficiencyCommentModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <h4 id="ineffCommentPrinterName" style="color: #00d4ff; margin-bottom: 5px;">Printer Name</h4>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap; font-size: 14px; color: #888;">
                        <span><strong id="ineffCommentTypeLabel">Type:</strong> <span id="ineffCommentType">Gap</span></span>
                        <span><strong id="ineffCommentDurationLabel">Duration:</strong> <span id="ineffCommentDuration">15m</span></span>
                    </div>
                    <div style="margin-top: 8px; font-size: 13px; color: #666;">
                        <span id="ineffCommentPeriod">Period: 2024-01-01 10:00 - 10:15</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ineffCommentTextarea" id="ineffCommentLabel">Comment / Reason:</label>
                    <textarea 
                        id="ineffCommentTextarea" 
                        rows="5" 
                        placeholder="Enter the reason for this inefficiency period..."
                        style="width: 100%; padding: 10px; border: 1px solid #444; background: #2a2a2a; color: #fff; border-radius: 5px; font-family: inherit; resize: vertical;"
                    ></textarea>
                    <small id="ineffCommentHint" style="color: #888; display: block; margin-top: 5px;">
                        üí° Example: Material change, maintenance, waiting for parts, operator break, etc.
                    </small>
                </div>
                
                <div class="modal-footer" style="margin-top: 20px; gap: 10px;">
                    <button class="btn btn-primary" onclick="saveInefficiencyComment()">
                        <span id="ineffCommentSaveBtn">üíæ Save Comment</span>
                    </button>
                    <button class="btn btn-danger" onclick="deleteInefficiencyComment()" id="ineffCommentDeleteBtn" style="display: none;">
                        <span id="ineffCommentDeleteText">üóëÔ∏è Delete</span>
                    </button>
                    <button class="btn btn-secondary" onclick="closeInefficiencyCommentModal()">
                        <span id="ineffCommentCancelBtn">Cancel</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Clear Analytics Confirmation Modal -->
    <div id="clearAnalyticsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="clearAnalyticsModalTitle">‚ö†Ô∏è Clear Analytics Data</h3>
                <span class="close" onclick="closeClearAnalyticsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="clearAnalyticsWarning1" style="font-size: 16px; line-height: 1.6; color: #e74c3c; font-weight: bold;">
                    ‚ö†Ô∏è Warning! This action is irreversible!
                </p>
                <p id="clearAnalyticsWarning2" style="font-size: 14px; line-height: 1.6; margin-top: 15px;">
                    All analytics data will be permanently deleted, including:
                </p>
                <ul style="margin-top: 10px; line-height: 1.8;">
                    <li id="clearAnalyticsItem1">Print and idle time history</li>
                    <li id="clearAnalyticsItem2">All status transition events</li>
                    <li id="clearAnalyticsItem3">Inefficiency periods and operator reports</li>
                    <li id="clearAnalyticsItem4">Energy consumption statistics</li>
                </ul>
                <p id="clearAnalyticsWarning3" style="font-size: 14px; line-height: 1.6; margin-top: 15px; color: #888;">
                    Power settings (wattage, cost per kWh) will be preserved.
                </p>
                <p id="clearAnalyticsConfirm" style="font-size: 14px; line-height: 1.6; margin-top: 15px; font-weight: bold;">
                    Are you sure you want to continue?
                </p>
                <div class="modal-footer" style="margin-top: 20px; gap: 10px;">
                    <button class="btn btn-danger" onclick="confirmClearAnalytics()">
                        <span id="clearAnalyticsYesBtn">Yes, Clear All Data</span>
                    </button>
                    <button class="btn btn-secondary" onclick="closeClearAnalyticsModal()">
                        <span id="clearAnalyticsNoBtn">Cancel</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bambu Lab Info Modal -->
    <div id="bambuInfoModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="bambuInfoModalTitle">üéã Bambu Lab</h3>
                <span class="close" onclick="closeBambuInfoModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p style="font-size: 16px; line-height: 1.6;">
                    <strong id="bambuPrinterName"></strong>
                </p>
                <p id="bambuInfoMessage" style="font-size: 14px; line-height: 1.6; margin-top: 15px;">
                    ‚ÑπÔ∏è Bambu Lab printers use mobile app <strong>Bambu Handy</strong> or <strong>Bambu Studio</strong> for control.
                </p>
                <p id="bambuInfoNoWeb" style="font-size: 14px; line-height: 1.6; margin-top: 10px; color: #888;">
                    There is no local web interface available for this printer type.
                </p>
                <div class="modal-footer" style="margin-top: 20px;">
                    <button class="btn btn-help" onclick="showBambuLabHelpModal()" style="margin-right: auto;">‚ùì <span id="bambuInfoHelpBtn">Help</span></button>
                    <button class="btn btn-primary" onclick="closeBambuInfoModal()">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Scan Modal -->
    <div id="networkScanModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="networkScanModalTitle">üîß Add & Manage Printers</h3>
                <span class="close" onclick="closeNetworkScanModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Printer Management Options -->
                <div id="scanOptions" class="form-group" style="margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="openAddPrinterModal(); closeNetworkScanModal();">
                            ‚ûï <span id="addManuallyBtn">Add Manually</span>
                        </button>
                        <button class="btn btn-secondary" onclick="executeScan('full')">
                            üîç <span id="startScanBtn">Scan Network</span>
                        </button>
                        <button class="btn btn-secondary" onclick="importPrinters(); closeNetworkScanModal();">
                            üì• <span id="importFromFileBtn">Import</span>
                        </button>
                        <button class="btn btn-secondary" onclick="exportPrinters(); closeNetworkScanModal();">
                            üì§ <span id="exportToFileBtn">Export</span>
                        </button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 6px; text-align: center; color: #888; font-size: 12px;">
                        <small id="addManuallyHint">‚ûï Add printer by IP</small>
                        <small id="scanHint">üîç Find in network</small>
                        <small id="importHint">üì• Restore backup</small>
                        <small id="exportHint">üì§ Save config</small>
                    </div>
                </div>

                <!-- Scan Progress -->
                <div id="scanProgress" style="display: none; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #333; border-top-color: #00d4ff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="scanProgressText">Scanning network...</span>
                    </div>
                    <div style="background: #2a2a2a; border-radius: 5px; overflow: hidden; height: 8px;">
                        <div id="scanProgressBar" style="background: linear-gradient(90deg, #00d4ff, #0088ff); height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    <div style="margin-top: 5px; font-size: 12px; color: #666;">
                        <span id="scanProgressDetails">0 / 0 IPs checked</span>
                    </div>
                </div>

                <!-- Scan Results -->
                <div id="scanResults" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                        <h4 id="scanResultsTitle" style="margin: 0;">Found Printers (<span id="foundPrintersCount">0</span>)</h4>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span id="selectedPrintersCount" style="display: none; color: #00d4ff; font-weight: bold; font-size: 14px;"></span>
                            <button class="btn btn-secondary btn-small" onclick="selectAllPrinters()" id="selectAllPrintersBtn">
                                <span id="selectAllBtnText">Select All</span>
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="deselectAllPrinters()" id="deselectAllPrintersBtn">
                                <span id="deselectAllBtnText">Deselect All</span>
                            </button>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="batchAddSelectedPrinters()" id="batchAddSelectedBtn" disabled>
                            ‚ûï <span id="batchAddSelectedBtnText">Add Selected (0)</span>
                        </button>
                        <button class="btn btn-secondary" onclick="batchAddAllPrinters()" id="batchAddAllBtn">
                            ‚ûï <span id="batchAddAllBtnText">Add All New</span>
                        </button>
                    </div>
                    <div id="scanResultsList" style="max-height: 400px; overflow-y: auto;">
                        <!-- Results will be dynamically added here -->
                    </div>
                </div>

                <!-- No Results Message -->
                <div id="scanNoResults" style="display: none; text-align: center; padding: 40px 20px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">üîç</div>
                    <p id="noResultsMessage" style="font-size: 16px; color: #888;">No printers found on the network</p>
                    <small id="noResultsTip" style="color: #666;">Make sure printers are powered on and connected to the same network</small>
                </div>

                <div class="modal-footer" style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
                    <button class="btn btn-help" onclick="showPrinterManagementHelp()" style="margin-right: auto;">
                        ‚ùì <span id="helpBtnText">Help</span>
                    </button>
                    <button class="btn btn-secondary" onclick="closeNetworkScanModal()">
                        <span id="scanCloseBtn">Close</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio element for completion sound -->
    <audio id="completionSound" preload="auto">
        <source src="windows-xp-print-complete.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Temperature Sensors Selection Modal -->
    <div id="tempSensorsModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>üå°Ô∏è <span id="tempSensorsModalTitle"></span></h3>
                <span class="close" onclick="closeTempSensorsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="tempSensorsDescription" style="color: #ccc; margin-bottom: 15px;">
                    <strong id="tempSensorsForAdvanced"></strong> <span id="tempSensorsDescText"></span><br>
                    <span id="tempSensorsAutoRecommended"></span>
                </p>
                <div id="tempSensorsContent" style="margin: 20px 0;">
                    <!-- Dynamically filled -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="saveTempSensorsSelection()"><span id="tempSensorsSaveBtn"></span></button>
                    <button class="btn" onclick="closeTempSensorsModal()"><span id="tempSensorsSkipBtn"></span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Telegram Help Modal -->
    <div id="telegramHelpModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="telegramHelpTitle">Telegram Bot Setup Help</h2>
                <span class="close" onclick="closeTelegramHelpModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="analytics-card" style="margin: 0;">
                    <div class="analytics-help-content" id="telegramHelpContent">
                        <!-- Content will be filled by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeTelegramHelpModal()" data-i18n="close">Close</button>
            </div>
        </div>
    </div>

    <!-- Bambu Lab Help Modal -->
    <div id="bambuLabHelpModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="bambuLabHelpTitle">Bambu Lab Printer Setup</h2>
                <span class="close" onclick="closeBambuLabHelpModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="analytics-card" style="margin: 0;">
                    <div class="analytics-help-content" id="bambuLabHelpContent">
                        <!-- Content will be filled by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeBambuLabHelpModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Web Server Modal -->
    <div id="webServerModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>üåê <span id="webServerModalTitle" data-i18n="web_server_modal_title">Web Server Settings</span></h2>
                <span class="close" onclick="closeWebServerModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="analytics-card" style="margin: 0;">
                    <div style="padding: 1.5rem;">
                        <div class="web-server-status" id="webServerStatus" style="background: rgba(0, 212, 255, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(0, 212, 255, 0.3);">
                            <div class="status-indicator">
                                <span class="status-dot" id="webServerStatusDot"></span>
                                <span id="webServerStatusText" style="color: #00d4ff; font-weight: 600;" data-i18n="web_server_status_checking">Checking...</span>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 1.5rem;">
                            <label for="webServerPort" style="color: #7ea8c8; font-weight: 600; margin-bottom: 0.5rem; display: block;">
                                <span id="webServerPortLabel" data-i18n="web_server_port_label">Server Port:</span>
                            </label>
                            <input type="number" id="webServerPort" value="8000" min="1000" max="65535" 
                                   style="width: 100%; padding: 0.7rem; background: rgba(10, 22, 40, 0.5); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 8px; font-size: 1rem; color: #00d4ff;">
                            <small style="color: #7ea8c8; display: block; margin-top: 0.5rem;">
                                <span id="webServerPortHint" data-i18n="web_server_port_hint">Recommended: 8000-9000</span>
                            </small>
                        </div>

                        <div class="web-server-info" id="webServerInfo" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(0, 212, 255, 0.15); border-radius: 8px; border: 1px solid rgba(0, 212, 255, 0.4);">
                            <p style="margin: 0 0 0.5rem 0; font-weight: 600; color: #00d4ff;">
                                üåê <span id="webServerUrlText" data-i18n="web_server_url_text">Web interface is available at:</span>
                            </p>
                            <div id="webServerUrl" style="margin: 0.5rem 0; line-height: 1.8; font-size: 0.95rem;">
                                <a href="http://localhost:8000" onclick="openWebInterfaceLink(event)" style="color: #4dabf7; text-decoration: none; font-weight: 500;">
                                    http://localhost:8000
                                </a>
                            </div>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #b8d4e8;">
                                <span id="webServerClientsText" data-i18n="web_server_clients_text">Connected clients:</span> <strong style="color: #00d4ff;" id="webServerClients">0</strong>
                            </p>
                        </div>

                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 8px; border: 1px solid rgba(0, 212, 255, 0.2);">
                            <h4 style="margin-top: 0; color: #00d4ff;">
                                <span id="webServerWhatIsItTitle" data-i18n="web_server_what_is_it_title">What is this?</span>
                            </h4>
                            <p style="margin: 0.5rem 0; line-height: 1.6; color: #b8d4e8;">
                                <span id="webServerWhatIsItText" data-i18n="web_server_what_is_it_text">
                                    Web server allows you to manage printers through a browser from any device on your local network. Just open the address on your computer, tablet or phone.
                                </span>
                            </p>
                            <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.8; color: #b8d4e8;">
                                <li><span id="webServerFeature1" data-i18n="web_server_feature1">View status of all printers</span></li>
                                <li><span id="webServerFeature2" data-i18n="web_server_feature2">Real-time monitoring</span></li>
                                <li><span id="webServerFeature3" data-i18n="web_server_feature3">Access from any device on network</span></li>
                                <li><span id="webServerFeature4" data-i18n="web_server_feature4">No installation required</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info" onclick="openWebServerHelp()" style="margin-right: auto;">
                    <span id="webServerHelpBtnText" data-i18n="web_server_btn_help">üìñ Help</span>
                </button>
                <button class="btn btn-success" id="webServerToggleBtn" onclick="toggleWebServer()">
                    <span id="webServerToggleBtnText" data-i18n="web_server_btn_start">‚ñ∂Ô∏è Start</span>
                </button>
                <button class="btn btn-primary" id="webServerOpenBtn" onclick="openWebInterfaceLink()" style="display: none;">
                    <span id="webServerOpenBtnText" data-i18n="web_server_btn_open">Open in Browser</span>
                </button>
                <button class="btn btn-secondary" onclick="closeWebServerModal()">
                    <span id="webServerCloseBtnText" data-i18n="web_server_btn_close">Close</span>
                </button>
            </div>
        </div>
    </div>

    <script src="../node_modules/chart.js/dist/chart.umd.js"></script>
    <script src="translations.js"></script>
    <script src="renderer.js"></script>
</body>
</html>