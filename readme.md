<div align="center">

<img src="logo.png" alt="3D Printer Control Panel Logo" width="250">

# 🖨️ 3D Printer Control Panel

**[🇷🇺 Русский](README.md)** | **[🇬🇧 English](docs/README_EN.md)**

![3D Printer Control Panel](https://img.shields.io/badge/Версия-1.5.9-blue.svg)
![Electron](https://img.shields.io/badge/Electron-22.0+-green.svg)
![Node.js](https://img.shields.io/badge/Node.js-14.0+-green.svg)
![Платформа](https://img.shields.io/badge/Платформа-Windows%20%7C%20Linux%20%7C%20Mac-lightgrey.svg)
![Языки](https://img.shields.io/badge/Языки-Русский%20%7C%20Английский-green.svg)

**Панель управления для 3D принтеров с прошивкой Klipper и Bambu Lab**  
*Удобный интерфейс для мониторинга и управления несколькими 3D-принтерами*

> **📥 Скачивание:** Все релизы доступны на официальном сайте **[tomich.fun/download](https://tomich.fun/download)**

**[⬇️ Быстрый переход к разделам](#-оглавление)**

</div>

---

## 📑 Оглавление

<table>
<tr>
<td width="50%">

### 🚀 Быстрый старт
- **[👥 Для кого эта программа?](#-для-кого-эта-программа)**
- **[🚀 Установка](#-установка)**
- **[📋 Добавление принтеров](#-добавление-принтеров)**
- **[🎋 Поддержка Bambu Lab](#-поддержка-bambu-lab)**

### 📚 Возможности
- **[🌟 Основные возможности](#-основные-возможности)**
- **[🎯 Особенности системы](#-особенности-системы)**
- **[🎉 Преимущества](#-преимущества)**

</td>
<td width="50%">

### ⚙️ Справка и настройка
- **[🆘 Решение проблем](#-решение-проблем)**
- **[🔧 Технические детали](#-технические-детали)**
- **[📚 Дополнительная документация](#-дополнительная-документация)**

### 📝 Информация
- **[📋 История изменений](#-история-изменений)**
- **[💝 Поддержать проект](#-поддержать-проект)**
- **[📄 Лицензия](#-лицензия)**
- **[🤝 Участие в разработке](#-участие-в-разработке)**

</td>
</tr>
</table>

---

## 👥 Для кого эта программа?

### 🎯 Целевая аудитория

**В первую очередь для операторов 3D ферм, во вторую - для их руководителей.**

### 🚨 Основная задача программы

**Вовремя предупредить оператора о том, что необходимо его внимание к определенному принтеру.**

Критические события, требующие немедленного реагирования:
- 🔴 **Ошибка** - принтер остановился с ошибкой
- ⏸️ **Пауза** - печать приостановлена
- 🏁 **Завершение печати** - нужно убрать модель и запустить следующую печать

### 📺 Режим отображения

Программа **идеально подходит для вывода на большой монитор или телевизор** в производственном помещении:
- ✅ Крупные элементы интерфейса видны издалека
- ✅ Цветовая индикация - мгновенное определение статуса
- ✅ Динамическая сортировка - важное всегда наверху
- ✅ Адаптивный дизайн - работает на любых разрешениях

> **"Карась не дремай"** - при срабатывании события (ошибка/пауза/завершение) проигрывается звук Windows XP.  
> *(Зацикливание звука признано неудачной идеей и не реализовано)*

### 🎯 Умная сортировка карточек

**Порядок отображения карточек принтеров динамический не просто так:**

Чем ближе к проблеме и необходимости внимания - тем выше приоритет и соответственно номер в очереди.

#### Приоритеты (от высшего к низшему):
1. 🔴 **Ошибка** - требует немедленного внимания
2. ⏸️ **Пауза** - принтер ждёт действий
3. 🏁 **Завершено** - нужно убрать модель
4. 🟢 **Печатает 95-100%** - **автоматически перемещается выше!**
5. 🟡 **Готов** - ожидает задания
6. 🟢 **Печатает** - работает нормально
7. ⚫ **Оффлайн** - не мешает работе

> **Особенность:** При приближении к окончанию печати (95-100%) карточка **автоматически перемещается выше** в списке, чтобы оператор подготовился к смене модели.

### 📏 Масштабируемость интерфейса

**Если карточки всех принтеров не вмещаются на мониторе - это не страшно!**

- Проценты печати **специально укрупнены** для видимости на расстоянии
- Критические принтеры всегда наверху и на виду
- Можно прокручивать список для просмотра всех принтеров
- Принтеры в работе и требующие внимания всегда видны без прокрутки

### 💡 Концепция работы

1. **Оператор видит большой экран** с панелью управления
2. **Принтеры работают** - карточки зелёные, внизу списка
3. **Принтер приближается к завершению** - карточка поднимается вверх
4. **Печать завершена** - карточка наверху, мигает красным, **звуковой сигнал**
5. **Оператор реагирует** - убирает модель, запускает следующую печать
6. **Цикл повторяется** для максимальной эффективности фермы

---

## 🌟 Основные возможности

### 🔌 Управление питанием через умные розетки **[⚡ НОВОЕ в v1.5.33]**
- **🔌 Tuya Cloud API** - прямое подключение к Smart Life розеткам
- **🏠 Home Assistant** - универсальное решение для всех брендов (Tuya, Яндекс, TP-Link и т.д.)
- **⚡ Ручное управление** - кнопка питания на каждой карточке принтера
- **🤖 Автоматизация:**
  - Автоотключение после завершения печати (настраиваемая задержка)
  - Автоотключение при ошибке печати
  - 🔥 Защита от перегрева (аварийное отключение при MCU > 70°C)
- **📚 Подробные инструкции:**
  - 📖 [Настройка Tuya Smart Plugs](docs/TUYA_USER_GUIDE.md) - пошаговое руководство
  - 📖 [Настройка Home Assistant](docs/HOME_ASSISTANT_USER_GUIDE.md) - для всех брендов розеток

### 📊 Мониторинг принтеров
- **🔢 Мультипринтерная поддержка** - одновременное отслеживание нескольких принтеров
- **🎨 Визуальные статусы** с цветовой индикацией и анимациями:
  - 🔴 **Ошибка/Пауза/Завершено** - красное мигание + звуковой сигнал
  - 🟡 **Готов** - желтое мигание
  - 🟢 **Печатает** - зеленое мигание (95-100% - автоматически выше в списке)
  - ⚫ **Оффлайн** - без анимации
- **📈 Детальная информация** о каждом принтере:
  - 🌡️ **Умные температурные датчики** с визуальными предупреждениями:
    - 🔥 Сопло > 170°C отображается **красным** (предупреждение о горячей поверхности)
    - 🔥 MCU > 60°C отображается **красным и увеличенным** (критический перегрев!)
  - 🌡️ **Гибкая настройка датчиков температуры**:
    - Автоматическое определение камеры/MCU/Raspberry Pi
    - Продвинутый режим для выбора конкретных датчиков
    - Пользовательские названия для любых датчиков
  - 📊 **Прогресс печати увеличенным шрифтом** - виден на расстоянии
  - 📁 Имя текущего файла
  - 🔄 Состояние печати
  - ⏰ Время последнего обновления
- **📲 Телеграм бот** - важные уведомления в вашем телефоне!
- **🔊 Звуковые оповещения** - звук Windows XP при критических событиях

### 🔌 Технологии подключения
- **🔄 Двойной протокол** - HTTP polling + WebSocket для реального времени
- **🔁 Автоматическое переподключение** при потере связи
- **🌙 Поддержка Moonraker API** с полным обнаружением датчиков
- **🎋 MQTT для Bambu Lab** принтеров
- **⚡ Быстрая проверка подключения** для всех принтеров

### ⚙️ Управление принтерами
- **➕ Добавление/🗑️ удаление** принтеров через интуитивный интерфейс
- **✏️ Редактирование настроек** (название, IP, порты)
- **🌐 Быстрый доступ** к веб-интерфейсам принтеров (Fluidd/Mainsail)
- **🌐 Встроенный Web-сервер** - доступ через браузер с любого устройства в сети! **[⚡ НОВОЕ]**
  - 📱 Открывайте панель на телефоне, планшете или другом компьютере
  - 🔄 Real-time обновления через WebSocket
  - 🛠️ REST API для интеграции с другими системами
  - 📖 [Подробная документация](docs/WEB_SERVER.md)
- **🌡️ Настройка датчиков температуры** - выберите, что показывать на карточке принтера
- **⏱️ Настраиваемый интервал** опроса (10-90 секунд)

### 📱 Интерфейс и UX
- **📱 Адаптивный дизайн** для компьютеров и мобильных устройств
- **💻 PWA для планшетов** - установка на iPad и Android как нативное приложение **[⚡ ПЛАНИРУЕТСЯ]**
  - 📱 Работает offline
  - 🎯 Touch-оптимизированный интерфейс
  - 📖 [Анализ портирования на планшеты](docs/TABLET_ПОРТИРОВАНИЕ_КРАТКО.md)
- **🔢 Умная сортировка** принтеров по приоритету статуса
- **📋 Система логов** с экспортом и очисткой
- **🪟 Модальные окна** для настройки
- **⌨️ Поддержка горячих клавиш** (Enter для подтверждения)
- **🌍 Мультиязычность** - автоматическое определение русского/английского

### 📈 Аналитика и мониторинг
- **📊 Профессиональные графики Chart.js** - интерактивные визуализации
- **⚡ Энергопотребление** - подробный расчёт потребления электроэнергии
- **💰 Стоимость энергии** - автоматический расчёт затрат на электричество
- **📈 Эффективность работы** - анализ времени печати vs простоя
- **⏱️ Периоды неэффективности** - отслеживание пауз и простоев с комментариями операторов
- **🗑️ Управление данными** - очистка устаревших данных
- **📖 Справочник по расчёту мощности** - инструкция для настройки

---

## 📥 Скачивание

> **⚠️ ВАЖНО:** Релизы теперь доступны на официальном сайте: **[tomich.fun/downloads](https://tomich.fun/downloads)**

Скачайте установочный файл с [**официального сайта**](https://tomich.fun/downloads)

### Платформы:
- ✅ **Windows** 10/11 (автоматическая установка)
- ✅ **macOS** 10.15+ (DMG установщик)
- ✅ **Linux** (AppImage, портативная версия)

---

## 🎋 Поддержка Bambu Lab

Приложение поддерживает принтеры **Bambu Lab** через MQTT протокол!

### Инструкция по настройке:
- 📖 [**Полная инструкция по настройке Bambu Lab**](docs/BAMBU_LAB_SETUP_RU.md)

### Основные требования:
- ✅ Режим разработчика включен на принтере
- ✅ Access Code из настроек принтера
- ✅ Серийный номер принтера
- ✅ Подключение к локальной сети

---

## 📋 Добавление принтеров

### Для Klipper принтеров:
1. ➕ Нажмите "Добавить принтер"
2. 📝 Выберите тип "Klipper" и заполните данные:
   - **🏷️ Название** - произвольное имя принтера
   - **🌐 IP адрес** - локальный IP принтера в сети
   - **🔌 Порт Moonraker** - обычно `7125`
   - **🖥️ Порт веб-интерфейса** - обычно `80` или `4408`/`4409`

### Настройка датчиков температуры (Klipper):
После добавления принтера нажмите кнопку **🌡️** на карточке принтера для настройки отображения температурных датчиков.

**Два режима работы:**
- **Простой (по умолчанию)** - автоматическое определение камеры, ничего настраивать не нужно
- **Продвинутый** - выберите конкретные датчики и дайте им свои названия

### Для Bambu Lab принтеров:
1. ➕ Нажмите "Добавить принтер"
2. 📝 Выберите тип "Bambu Lab" и заполните данные:
   - **🏷️ Название** - произвольное имя принтера
   - **🌐 IP адрес** - локальный IP принтера в сети
   - **🔑 Access Code** - 8-значный код из режима разработчика
   - **🔢 Серийный номер** - серийник с принтера

📖 **Подробная инструкция**: [BAMBU_LAB_SETUP_RU.md](docs/BAMBU_LAB_SETUP_RU.md)

---

## 🎯 Особенности системы

### 🎯 Приоритеты статусов (умная динамическая сортировка)

Чем ближе к проблеме и необходимости внимания - тем выше приоритет:

1. 🔴 **Ошибка** - критическая проблема, требует немедленного внимания
2. ⏸️ **Пауза** - принтер остановлен, нужны действия
3. 🏁 **Завершено** - модель готова, нужно убрать и запустить следующую печать
4. 🟢 **Печатает 95-100%** - **автоматически поднимается выше!** Оператор готовится к смене
5. 🟡 **Готов** - ожидает задания
6. 🟢 **Печатает** - работает нормально
7. ⚫ **Оффлайн** - не мешает работе, внизу списка

> **Важно:** Если карточки не вмещаются на мониторе - не страшно! При приближении к окончанию печати (95-100%) карточка **автоматически переместится выше** в списке, и оператор всегда увидит принтеры, требующие внимания.

### 🌡️ Визуальные предупреждения температуры
- **🔥 Сопло > 170°C** - красный цвет (горячая поверхность!)
- **🔥 MCU > 60°C** - красный цвет + увеличенный шрифт x2 (критический перегрев!)
- Автоматическое определение датчиков MCU/Board/Mainboard

### 🔊 Звуковые оповещения
- **Звук Windows XP** проигрывается при критических событиях:
  - 🏁 Завершение печати
  - ⏸️ Пауза
  - 🔴 Ошибка
- Проигрывается **3 раза** для привлечения внимания
- Зацикливание признано неудачной идеей и не реализовано

### 🧠 Умное определение статуса
Система анализирует несколько источников данных для точного определения состояния:
- `print_stats.state`
- `virtual_sdcard.is_active` 
- `display_status.progress`
- 📁 Активность печати по имени файла

---

<details>
<summary><h2 style="display: inline">🔧 Технические детали</h2></summary>

### 🛠️ Используемые технологии:
- **Electron 22.0+** - кроссплатформенный фреймворк
- **Node.js 14.0+** - серверная платформа JavaScript
- **Chart.js 4.5+** - библиотека для графиков
- **MQTT 5.3+** - для связи с Bambu Lab
- **WebSocket** - для реального времени с Klipper
- **electron-store** - для хранения настроек
- **HTML/CSS/JavaScript** - современный интерфейс

### ✅ Совместимость

#### Поддерживаемые принтеры:
- ✅ **Klipper** с **Moonraker** (через HTTP/WebSocket)
- ✅ **Bambu Lab** (через MQTT) - X1, X1C, P1P, P1S, A1, A1 Mini и другие
- ✅ **Fluidd** и **Mainsail** веб-интерфейсы

</details>

---

<details>
<summary><h2 style="display: inline">📋 История изменений</h2></summary>

### 🆕 v1.5.2 (Текущая версия)
- **🐛 Исправления** - сохранение настроек температурных датчиков, иконка для Linux
- **🎋 Bambu Lab поддержка** - работает стабильно
- **⚡ Оптимизация** - быстрый запуск приложения

### 🆕 v1.5.0 - Analytics Export & Performance
- **📥 Экспорт статистики** - JSON файл для диагностики
- **⚡ Оптимизация** - параллельная загрузка данных

### 🆕 v1.4.0 - Smart Temperature Monitoring
- **🌡️ Умные температурные датчики** - гибкая настройка отображения
- **🔥 Визуальные предупреждения** - критические температуры выделяются цветом

📝 **Полный changelog**: [changelog.md](docs/changelog.md)

</details>

---

<details>
<summary><h2 style="display: inline">🆘 Решение проблем</h2></summary>

### ❌ Klipper принтер не подключается
- 🔍 Проверьте IP адрес и порт Moonraker (обычно 7125)
- 🌐 Убедитесь, что принтер доступен в сети
- 🛡️ Проверьте настройки firewall
- 🔧 Проверьте настройки CORS в Moonraker

### 🎋 Bambu Lab принтер не подключается

**🚀 Быстрое решение:**
1. **Перезагрузите принтер** (выключите и включите питание)
2. Проверьте **режим разработчика** (должен быть включен)
3. Проверьте **IP адрес** на экране принтера
4. **Удалите и добавьте принтер заново** в приложении

**📖 Подробные инструкции:**
- 🔧 [**Полное руководство по устранению неполадок**](docs/BAMBU_TROUBLESHOOTING_RU.md) - **НАЧНИТЕ ЗДЕСЬ**
- 📋 [Инструкция по настройке Bambu Lab](docs/BAMBU_LAB_SETUP_RU.md)

**Основные причины проблем:**
- 🔑 Режим разработчика не включен или **принтер не перезагружался** после включения
- 📝 Неправильный **Access Code** (8 цифр, без пробелов)
- 🔢 Неправильный **серийный номер** (15 символов, формат: `01P00A123456789`)
- 🌐 Принтер и ПК в **разных сетях** (проверьте ping)
- 🛡️ Firewall блокирует **порт 8883**
- 📍 IP адрес изменился после перезагрузки роутера

### 🌡️ Не видны дополнительные датчики температуры (Klipper)
- ⚙️ Убедитесь, что датчики настроены в конфигурации Klipper
- 🔍 Нажмите кнопку **🌡️** на карточке принтера для настройки
- 📋 Выберите нужные датчики и дайте им названия
- ℹ️ Камера определяется автоматически (по умолчанию)

### 🔥 MCU показывает высокую температуру
- ⚠️ Это критическое предупреждение о перегреве платы!
- ✅ Улучшите охлаждение электроники
- ✅ Снизьте температуру камеры
- ✅ Вынесите плату управления за пределы камеры

</details>

---

## 🎉 Преимущества

- **🆓 Бесплатно** - полный исходный код
- **🚀 Простота** - готовое решение с установщиком
- **🎋 Универсальность** - Klipper и Bambu Lab в одном приложении
- **📱 Удобство** - единая панель для всех принтеров
- **⚡ Скорость** - оптимизированные запросы
- **🔧 Гибкость** - настраиваемые параметры
- **🌍 Мультиязычность** - русский/английский
- **📺 Для больших мониторов** - укрупненные элементы, видно издалека
- **🎯 Для операторов ферм** - умная сортировка, звуковые сигналы

---

## 📚 Дополнительная документация

### 📂 [Вся документация в папке docs/](docs/INDEX.md)

**Быстрые ссылки:**
- 📱 **[Портирование на планшеты](docs/TABLET_ПОРТИРОВАНИЕ_КРАТКО.md)** ⚡ НОВОЕ - анализ возможности создания PWA для iPad и Android
- 📱 **[Пошаговый гид PWA](docs/PWA_IMPLEMENTATION_CHECKLIST.md)** ⚡ НОВОЕ - готовый чеклист для разработки
- 🔌 **[Настройка Tuya Smart Plugs](docs/TUYA_USER_GUIDE.md)** - управление питанием через Smart Life
- 🏠 **[Настройка Home Assistant](docs/HOME_ASSISTANT_USER_GUIDE.md)** - для всех брендов розеток (Tuya, Яндекс и т.д.)
- 🌐 **[Web-сервер и REST API](docs/WEB_SERVER.md)** - доступ через браузер
- 📖 [Настройка Bambu Lab](docs/BAMBU_LAB_SETUP_RU.md)
- 🔧 [Устранение неполадок Bambu Lab](docs/BAMBU_TROUBLESHOOTING_RU.md)
- 📊 [Документация по аналитике](docs/ANALYTICS_SUMMARY_RU.md)
- 📦 [Release Notes](docs/RELEASE_NOTES.md)
- 📝 [История изменений](docs/changelog.md)
- 🗺️ [Структура кода](docs/RENDERER_STRUCTURE_ADDED.md)

**🇬🇧 English:**
- 📖 [English README](docs/README_EN.md)
- 📋 [Bambu Lab Setup Guide](docs/BAMBU_LAB_SETUP.md)
- 🔧 [Troubleshooting Guide](docs/BAMBU_TROUBLESHOOTING_EN.md)

---

## 🤝 Участие в разработке

Приветствуются pull requests и предложения по улучшению!

---

## 💝 Поддержать проект

Если приложение помогает вам в работе, буду рад любой поддержке! 

### ⭐ Telegram Stars
Отправьте Telegram Stars на [@Tom_Tomich](https://t.me/Tom_Tomich)

### ₿ Криптовалюты

- **Bitcoin (BTC)**: `1BbmWrors1aT1Dzaxr7mZ1wAPrW742hpx4`
- **USDT (TRC20)**: `TK4dBymE4aZbXVQ8XRwxojh7i4JRamnfz6`
- **ETH/USDT (ERC20)**: `0xb041D2F44b79453DFB4344f8350a4Fd9Ba82D977`

> 💡 Любая поддержка мотивирует развивать проект и добавлять новые функции!

---

## 📄 Лицензия

**Некоммерческая лицензия** - свободное использование для личных, образовательных и некоммерческих целей.

Для **коммерческого использования** необходимо приобрести коммерческую лицензию.  
📧 **Контакт для покупки**: utolyana@ya.ru

📖 Полный текст лицензии: [LICENSE.md](LICENSE.md)

---

<div align="center">

*Разработано для операторов 3D-ферм и руководителей производств*

**⭐ Не забудьте поставить звезду, если проект вам понравился!**

**Поддержка: Klipper + Bambu Lab = Удобное управление всеми вашими принтерами! 🖨️🎋**

</div>
