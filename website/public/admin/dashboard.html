<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - 3D Printer Control Panel</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body class="admin-page">
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-logo">üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            <nav class="admin-nav">
                <ul>
                    <li><a href="/admin/dashboard" class="active">üìä –î–∞—à–±–æ—Ä–¥</a></li>
                    <li><a href="/admin/news">üì∞ –ù–æ–≤–æ—Å—Ç–∏</a></li>
                    <li><a href="/admin/telemetry.html">üìä –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è</a></li>
                    <li><a href="/admin/files.html">üìÅ –§–∞–π–ª—ã</a></li>
                    <li><a href="/admin/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                    <li><a href="/admin/logout">üö™ –í—ã—Ö–æ–¥</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="admin-container">
        <div class="admin-card">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üì∞</div>
                    <div class="stat-value" id="stat-news">-</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="stat-published">-</div>
                    <div class="stat-label">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value" id="stat-drafts">-</div>
                    <div class="stat-label">–ß–µ—Ä–Ω–æ–≤–∏–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéâ</div>
                    <div class="stat-value" id="stat-releases">-</div>
                    <div class="stat-label">–î–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–ª–∏–∑–æ–≤</div>
                </div>
            </div>
        </div>

        <div class="admin-card">
            <h2>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
            <div class="btn-group">
                <a href="/admin/news/new" class="btn-admin btn-admin-success">
                    ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å
                </a>
                <a href="/news" class="btn-admin btn-admin-primary" target="_blank">
                    üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∞–π—Ç
                </a>
                <a href="/downloads" class="btn-admin btn-admin-primary" target="_blank">
                    üì• –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–æ–∫
                </a>
                <a href="/admin/telemetry.html" class="btn-admin btn-admin-secondary">
                    üìä –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è
                </a>
            </div>
        </div>

        <div class="admin-card">
            <h2>üì∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h2>
            <div id="recent-news">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
        </div>

        <div class="admin-card">
            <h2>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h2>
            <div style="background: rgba(0, 212, 255, 0.1); padding: 20px; border-radius: 8px; border-left: 4px solid var(--admin-primary);">
                <h3 style="color: var(--admin-primary); margin-bottom: 15px;">üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</h3>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li>‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º TinyMCE</li>
                    <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–ª–∏–∑–æ–≤ —Å –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</li>
                    <li>‚úÖ –ü—Ä–æ–∫—Å–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏)</li>
                    <li>‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
                    <li>‚úÖ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π</li>
                    <li>‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Load statistics
        async function loadStats() {
            try {
                // Load news stats
                const newsResponse = await fetch('/api/news');
                if (newsResponse.ok) {
                    const news = await newsResponse.json();
                    document.getElementById('stat-news').textContent = news.length;
                    
                    const published = news.filter(n => n.published).length;
                    document.getElementById('stat-published').textContent = published;
                    document.getElementById('stat-drafts').textContent = news.length - published;
                    
                    // Show recent news
                    displayRecentNews(news.slice(0, 5));
                }
                
                // Load releases count
                const releasesResponse = await fetch('/api/releases');
                if (releasesResponse.ok) {
                    const releases = await releasesResponse.json();
                    document.getElementById('stat-releases').textContent = releases.length;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        function displayRecentNews(news) {
            const container = document.getElementById('recent-news');
            
            if (news.length === 0) {
                container.innerHTML = '<p style="color: var(--admin-text-secondary); text-align: center; padding: 40px;">–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            
            container.innerHTML = news.map(item => {
                const date = new Date(item.created_at).toLocaleDateString('ru-RU');
                const badge = item.published 
                    ? '<span class="badge badge-published">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>'
                    : '<span class="badge badge-draft">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>';
                
                return `
                    <div class="news-list-item">
                        <div>
                            <div class="news-list-title">${item.title}${badge}</div>
                            <div class="news-list-meta">üìÖ ${date}</div>
                        </div>
                        <div class="news-list-actions">
                            <a href="/admin/news/edit/${item.id}" class="btn-admin btn-admin-primary" style="padding: 8px 16px; font-size: 0.9em;">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </a>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Load stats on page load
        document.addEventListener('DOMContentLoaded', loadStats);
    </script>
</body>
</html>

