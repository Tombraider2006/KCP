<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body class="admin-page">
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-logo">üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            <nav class="admin-nav">
                <ul>
                    <li><a href="/admin/dashboard">üìä –î–∞—à–±–æ—Ä–¥</a></li>
                    <li><a href="/admin/news">üì∞ –ù–æ–≤–æ—Å—Ç–∏</a></li>
                    <li><a href="/admin/telemetry.html">üìä –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è</a></li>
                    <li><a href="/admin/files.html">üìÅ –§–∞–π–ª—ã</a></li>
                    <li><a href="/admin/settings" class="active">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                    <li><a href="/admin/logout">üö™ –í—ã—Ö–æ–¥</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="admin-container">
        <div class="admin-card">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞</h2>
            
            <div id="alert-container"></div>
            
            <form id="settings-form">
                <div class="form-group">
                    <label class="form-label" for="site_name">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞</label>
                    <input 
                        type="text" 
                        id="site_name" 
                        name="site_name" 
                        class="form-input" 
                        placeholder="3D Printer Control Panel"
                    >
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="site_description">–û–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞</label>
                    <textarea 
                        id="site_description" 
                        name="site_description" 
                        class="form-input" 
                        rows="3"
                        placeholder="–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –ø—Ä–æ–µ–∫—Ç–∞ 3D Printer Control Panel"
                    ></textarea>
                    <span class="form-hint">
                        –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ meta-—Ç–µ–≥–∞—Ö)
                    </span>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="github_repo">GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</label>
                    <input 
                        type="text" 
                        id="github_repo" 
                        name="github_repo" 
                        class="form-input" 
                        placeholder="username/repository"
                    >
                    <span class="form-hint">
                        –§–æ—Ä–º–∞—Ç: username/repository (–Ω–∞–ø—Ä–∏–º–µ—Ä: Tombraider2006/KCP)
                    </span>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="github_token">GitHub Personal Access Token</label>
                    <input 
                        type="password" 
                        id="github_token" 
                        name="github_token" 
                        class="form-input" 
                        placeholder="ghp_xxxxxxxxxxxx"
                    >
                    <span class="form-hint">
                        –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ª–∏–∑–∞–º –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. 
                        <a href="https://github.com/settings/tokens" target="_blank" style="color: var(--admin-primary);">
                            –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω ‚Üí
                        </a>
                    </span>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn-admin btn-admin-success">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
            </form>
        </div>

        <div class="admin-card">
            <h2>‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ GitHub Token</h2>
            <div style="background: rgba(0, 212, 255, 0.1); padding: 20px; border-radius: 8px; border-left: 4px solid var(--admin-primary);">
                <h3 style="color: var(--admin-primary); margin-bottom: 15px;">üîë –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å GitHub Personal Access Token?</h3>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ <a href="https://github.com/settings/tokens" target="_blank" style="color: var(--admin-primary);">GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens</a></li>
                    <li>–ù–∞–∂–º–∏—Ç–µ "Generate new token" ‚Üí "Generate new token (classic)"</li>
                    <li>–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: "3D Printer Website"</li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è "No expiration" –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)</li>
                    <li>–û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>repo</strong> - –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤</li>
                            <li><strong>public_repo</strong> - –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç—Ç–æ–≥–æ)</li>
                        </ul>
                    </li>
                    <li>–ù–∞–∂–º–∏—Ç–µ "Generate token" –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)</li>
                    <li>–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–æ–ª–µ –≤—ã—à–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ</li>
                </ol>
                
                <div style="background: rgba(255, 193, 7, 0.2); padding: 15px; border-radius: 6px; margin-top: 20px; border-left: 3px solid var(--admin-warning);">
                    <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>–•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!</li>
                        <li>–ù–µ –¥–µ–ª–∏—Ç–µ—Å—å —Ç–æ–∫–µ–Ω–æ–º —Å –¥—Ä—É–≥–∏–º–∏</li>
                        <li>–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π</li>
                        <li>–î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —Ç–æ–∫–µ–Ω –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load current settings
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                if (!response.ok) throw new Error('Failed to load settings');
                
                const settings = await response.json();
                
                document.getElementById('site_name').value = settings.site_name || '';
                document.getElementById('site_description').value = settings.site_description || '';
                document.getElementById('github_repo').value = settings.github_repo || '';
                document.getElementById('github_token').value = settings.github_token ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '';
                
            } catch (error) {
                console.error('Error loading settings:', error);
                showAlert('error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫');
            }
        }
        
        // Save settings
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const settings = {
                site_name: document.getElementById('site_name').value,
                site_description: document.getElementById('site_description').value,
                github_repo: document.getElementById('github_repo').value,
                github_token: document.getElementById('github_token').value
            };
            
            // Don't send masked token
            if (settings.github_token === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                delete settings.github_token;
            }
            
            try {
                // Save each setting
                for (const [key, value] of Object.entries(settings)) {
                    const response = await fetch('/api/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ key, value })
                    });
                    
                    if (!response.ok) throw new Error(`Failed to save ${key}`);
                }
                
                showAlert('success', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                setTimeout(() => loadSettings(), 1500);
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showAlert('error', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
            }
        });
        
        // Show alert
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alert-container');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            const icon = type === 'success' ? '‚úÖ' : '‚ùå';
            
            alertContainer.innerHTML = `
                <div class="alert ${alertClass}">
                    ${icon} ${message}
                </div>
            `;
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }
        
        // Load settings on page load
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>

